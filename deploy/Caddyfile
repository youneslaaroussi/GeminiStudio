# Caddy reverse proxy configuration
# Automatically provisions SSL from Let's Encrypt

{$DOMAIN:localhost}, www.{$DOMAIN:localhost} {
    # Billing service API (for Stripe webhooks and client calls)
    handle /credits/* {
        reverse_proxy billing-service:3100
    }

    # LangGraph API (AI agent endpoints)
    handle /teleport {
        reverse_proxy langgraph-server:8080
    }
    handle /teleport/* {
        reverse_proxy langgraph-server:8080
    }

    # Health check endpoint
    handle /health {
        respond "OK" 200
    }

    # Frontend - Next.js (catch-all, must be last)
    handle {
        reverse_proxy frontend:3000
    }
}
